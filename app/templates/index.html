<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Pipapa</title>
    <link rel="stylesheet" href="./static/css/frog.css">
    <script src="./static/js/frog.js"></script>
</head>
<body>
    <!-- 导航栏 -->
    <nav>    
        <ul>
            <li><a href="/" class="post-title">Home/</a></li>
            <li><a href="/tag" class="post-title">Tag/</a></li>
            <li><a href="/category" class="post-title">Category/</a></li>
            <li><a href="/about" class="post-title">About/</a></li>
        </ul>
    </nav>
    <!-- 文章列表 -->
    <div class="post" id="post">
        <table>
           
        </table>
        <!-- 翻页 -->
        <div class="page-bar">
               
        </div>        
    </div>
    <!-- 底部 -->
    <footer>
        Powered by <a href="https://github.com/Pipapa/FrogBlog">FrogBlog</a> &copy; 2017 Pipapa
    </footer>
</body>
<script>
    const tag_api_url = 'tag/'
    const category_api_url = 'category/'

    window.onload = function(){
        get_article_list()
    }

    var set_title = function(title,url){
        var title_a = document.createElement('a')
        title_a.setAttribute('href',url)
        title_a.className = 'post-title'
        title_a.innerHTML = title
        return title_a
    }

    var set_category = function(category){
        var category_a = document.createElement('a')
        category_a.innerHTML = category
        category_a.setAttribute('href',category_api_url + category)
        return category_a
    }

    var set_tag = function(tags){
        var tag_a = ''
        for(var i=0;i<tags.length;i++){
            tag_a = tag_a + '<a href="' + tag_api_url + tags[i] +'">' + tags[i] + "</a>"
            if(i != tags.length-1) tag_a += ','
        }
        return tag_a
    }

    var set_article_list = function(data){
        if(data['error'] == undefined){
            /* 获取数据 */
            var articles = data['data']
            
            var page_bar = document.getElementById('page-bar')
            var post_list = document.getElementById('post')

            var article_table = document.createElement('table')

            /* 输出列表 */
            var num_of_article = articles.length
            for(var i = 0; i < num_of_article ; i++){
                var list = document.createElement('tr')
                var time = document.createElement('td')
                var title = document.createElement('td')
                var divide_line = document.createElement('td')
                var category = document.createElement('td')
                var divide_symbol = document.createElement('td')
                var tag = document.createElement('td')

                /* 设置参数 */
                divide_line.innerHTML = '|'
                divide_symbol.innerHTML = '--->'
                time.innerHTML = articles[i].update_time + ' >'
                title.appendChild(set_title(articles[i].title,articles[i].url))
                category.appendChild(set_category(articles[i].category))
                tag.innerHTML = set_tag(articles[i].tag)
                
                /* append */
                var article_meta = [time,title,divide_line,category,divide_symbol,tag]
                for(var j = 0;j < article_meta.length ;j++)
                    list.appendChild(article_meta[j])
                post_list.appendChild(list)
            }

        }else{
            /* 参数出现错误 */

        }
    }

    var get_article_list = function(){
        var pre_page = getUrlParam('pre_page')
        var page = getUrlParam('page')
        if(!page) page=1
        if(!pre_page) pre_page=10
        var url = '/api/article?pre_page='+ pre_page +'&page' + page
        get_data(url,set_article_list)
    }
    /* 
                            var page_bar = document.createElement('div')
                            page_bar.setAttribute('class','page-bar')
                            if(data['has_prev']){
                                var prev = document.createElement('a')
                                prev.setAttribute('href','/article?page='+(parseInt(page)-1))
                                prev.innerHTML = '<'
                                page_bar.appendChild(prev)
                            }
                            var page_num = document.createElement('span')
                            page_num.innerHTML = 'page:' + data['page'] + '/' +data['num_of_page']
                            page_bar.appendChild(page_num)
                            if(data['has_next']){
                                var next = document.createElement('a')
                                next.setAttribute('href','/article?page='+(parseInt(page)+1))
                                next.innerHTML = '>'
                                page_bar.appendChild(next)
                            }
                            post_list.appendChild(page_bar)
                        }else{
                        }
                    }
                }else{
                }
            }
            request.open('GET',url,true)
            request.send()
        } */
    </script>
</html>